# 代理控制说明

## 自动开启代理功能已关闭

### 当前配置

已修改 `~/.bashrc` 文件，关闭了自动开启代理功能：

```bash
# 修改前
source /opt/clash/script/common.sh && source /opt/clash/script/clashctl.sh && watch_proxy

# 修改后
source /opt/clash/script/common.sh && source /opt/clash/script/clashctl.sh
# watch_proxy  # 已关闭自动开启代理功能，请手动使用 clashon/clashoff 控制
```

### 效果

- ✅ **脚本命令仍然可用**：`clashon`、`clashoff`、`clashstatus` 等命令仍然可用
- ✅ **不会自动开启代理**：打开新终端时不会自动开启代理
- ✅ **完全手动控制**：需要时手动开启，不需要时手动关闭

---

## 手动控制代理

### 开启代理

```bash
# 方法一：使用 clashon 命令
clashon

# 方法二：使用 clashctl 命令
clashctl on

# 输出示例：
# 😼 已开启代理环境
```

### 关闭代理

```bash
# 方法一：使用 clashoff 命令
clashoff

# 方法二：使用 clashctl 命令
clashctl off

# 输出示例：
# 😼 已关闭代理环境
```

### 查看代理状态

```bash
# 查看服务状态
clashstatus

# 查看系统代理状态
clashproxy

# 查看内核版本
/opt/clash/bin/mihomo -v
```

---

## 代理环境变量

### 开启代理后

开启代理后会自动设置以下环境变量：

```bash
export http_proxy=http://127.0.0.1:7893
export https_proxy=http://127.0.0.1:7893
export HTTP_PROXY=http://127.0.0.1:7893
export HTTPS_PROXY=http://127.0.0.1:7893
export all_proxy=socks5://127.0.0.1:7893
export ALL_PROXY=socks5://127.0.0.1:7893
export no_proxy=localhost,127.0.0.1,::1
export NO_PROXY=localhost,127.0.0.1,::1
```

### 关闭代理后

关闭代理后会自动清除这些环境变量。

### 检查当前代理状态

```bash
# 检查环境变量
echo $http_proxy

# 如果有输出，说明代理已开启
# 如果没有输出，说明代理已关闭
```

---

## 常用命令速查

```bash
# 加载脚本（如果命令不可用）
source /opt/clash/script/common.sh && source /opt/clash/script/clashctl.sh

# 开启代理
clashon

# 关闭代理
clashoff

# 查看状态
clashstatus

# 查看 Web 控制台
clashui

# 更新订阅
clashupdate

# 升级内核
clashupgrade
```

---

## 如何重新启用自动开启功能

如果将来需要重新启用自动开启功能，可以修改 `~/.bashrc`：

```bash
# 编辑 .bashrc
vim ~/.bashrc

# 找到这一行并取消注释
source /opt/clash/script/common.sh && source /opt/clash/script/clashctl.sh && watch_proxy

# 保存后重新加载
source ~/.bashrc
```

---

## 注意事项

1. **新终端不会自动开启代理**
   - 打开新终端时，代理不会自动开启
   - 需要手动执行 `clashon` 开启代理

2. **脚本命令仍然可用**
   - 虽然关闭了自动开启，但所有命令仍然可用
   - 可以随时使用 `clashon`/`clashoff` 控制代理

3. **服务状态独立**
   - `clashon`/`clashoff` 控制的是 systemd 服务
   - 服务可以在后台运行，但环境变量需要手动设置

4. **推荐使用方式**
   - 需要代理时：执行 `clashon`
   - 不需要代理时：执行 `clashoff`
   - 查看状态：执行 `clashstatus`

---

## 配置改动记录

### 2025-12-06

- **改动内容**：关闭自动开启代理功能
- **改动位置**：`~/.bashrc` 第 133 行
- **改动方式**：注释掉 `watch_proxy` 调用
- **效果**：打开新终端时不会自动开启代理，需要手动控制

---

**文档更新时间：** 2025-12-06

